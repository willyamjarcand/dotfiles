Write a `plan.md` containing a clear prompt for the Cursor Agent to perform the following task, with enough detail to remove any ambiguities. If you are not 95% confident in the specifications of the task, ask clarifying questions ONE BY ONE as not to overwhelm the user, until you have that confidence.

Each step in the plan should represent a distinct refactor or behaviour change. If code changes are required, apply TDD practices. Update the tests first, then update the code until the tests pass. At each step of the plan that includes code changes, ensure that corresponding tests are updated as well.

This is the task:

<TASK>
$ARGUMENTS
</TASK>
